{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.compileToken = exports.compileUnsafe = exports.compile = void 0;\nvar css_what_1 = require(\"css-what\");\nvar boolbase_1 = __importDefault(require(\"boolbase\"));\nvar sort_js_1 = __importStar(require(\"./sort.js\"));\nvar general_js_1 = require(\"./general.js\");\nvar subselects_js_1 = require(\"./pseudo-selectors/subselects.js\");\n/**\n * Compiles a selector to an executable function.\n *\n * @param selector Selector to compile.\n * @param options Compilation options.\n * @param context Optional context for the selector.\n */\nfunction compile(selector, options, context) {\n  var next = compileUnsafe(selector, options, context);\n  return (0, subselects_js_1.ensureIsTag)(next, options.adapter);\n}\nexports.compile = compile;\nfunction compileUnsafe(selector, options, context) {\n  var token = typeof selector === \"string\" ? (0, css_what_1.parse)(selector) : selector;\n  return compileToken(token, options, context);\n}\nexports.compileUnsafe = compileUnsafe;\nfunction includesScopePseudo(t) {\n  return t.type === css_what_1.SelectorType.Pseudo && (t.name === \"scope\" || Array.isArray(t.data) && t.data.some(function (data) {\n    return data.some(includesScopePseudo);\n  }));\n}\nvar DESCENDANT_TOKEN = {\n  type: css_what_1.SelectorType.Descendant\n};\nvar FLEXIBLE_DESCENDANT_TOKEN = {\n  type: \"_flexibleDescendant\"\n};\nvar SCOPE_TOKEN = {\n  type: css_what_1.SelectorType.Pseudo,\n  name: \"scope\",\n  data: null\n};\n/*\n * CSS 4 Spec (Draft): 3.4.1. Absolutizing a Relative Selector\n * http://www.w3.org/TR/selectors4/#absolutizing\n */\nfunction absolutize(token, _a, context) {\n  var adapter = _a.adapter;\n  // TODO Use better check if the context is a document\n  var hasContext = !!(context === null || context === void 0 ? void 0 : context.every(function (e) {\n    var parent = adapter.isTag(e) && adapter.getParent(e);\n    return e === subselects_js_1.PLACEHOLDER_ELEMENT || parent && adapter.isTag(parent);\n  }));\n  for (var _i = 0, token_1 = token; _i < token_1.length; _i++) {\n    var t = token_1[_i];\n    if (t.length > 0 && (0, sort_js_1.isTraversal)(t[0]) && t[0].type !== css_what_1.SelectorType.Descendant) {\n      // Don't continue in else branch\n    } else if (hasContext && !t.some(includesScopePseudo)) {\n      t.unshift(DESCENDANT_TOKEN);\n    } else {\n      continue;\n    }\n    t.unshift(SCOPE_TOKEN);\n  }\n}\nfunction compileToken(token, options, context) {\n  var _a;\n  token.forEach(sort_js_1.default);\n  context = (_a = options.context) !== null && _a !== void 0 ? _a : context;\n  var isArrayContext = Array.isArray(context);\n  var finalContext = context && (Array.isArray(context) ? context : [context]);\n  // Check if the selector is relative\n  if (options.relativeSelector !== false) {\n    absolutize(token, options, finalContext);\n  } else if (token.some(function (t) {\n    return t.length > 0 && (0, sort_js_1.isTraversal)(t[0]);\n  })) {\n    throw new Error(\"Relative selectors are not allowed when the `relativeSelector` option is disabled\");\n  }\n  var shouldTestNextSiblings = false;\n  var query = token.map(function (rules) {\n    if (rules.length >= 2) {\n      var first = rules[0],\n        second = rules[1];\n      if (first.type !== css_what_1.SelectorType.Pseudo || first.name !== \"scope\") {\n        // Ignore\n      } else if (isArrayContext && second.type === css_what_1.SelectorType.Descendant) {\n        rules[1] = FLEXIBLE_DESCENDANT_TOKEN;\n      } else if (second.type === css_what_1.SelectorType.Adjacent || second.type === css_what_1.SelectorType.Sibling) {\n        shouldTestNextSiblings = true;\n      }\n    }\n    return compileRules(rules, options, finalContext);\n  }).reduce(reduceRules, boolbase_1.default.falseFunc);\n  query.shouldTestNextSiblings = shouldTestNextSiblings;\n  return query;\n}\nexports.compileToken = compileToken;\nfunction compileRules(rules, options, context) {\n  var _a;\n  return rules.reduce(function (previous, rule) {\n    return previous === boolbase_1.default.falseFunc ? boolbase_1.default.falseFunc : (0, general_js_1.compileGeneralSelector)(previous, rule, options, context, compileToken);\n  }, (_a = options.rootFunc) !== null && _a !== void 0 ? _a : boolbase_1.default.trueFunc);\n}\nfunction reduceRules(a, b) {\n  if (b === boolbase_1.default.falseFunc || a === boolbase_1.default.trueFunc) {\n    return a;\n  }\n  if (a === boolbase_1.default.falseFunc || b === boolbase_1.default.trueFunc) {\n    return b;\n  }\n  return function combine(elem) {\n    return a(elem) || b(elem);\n  };\n}","map":{"version":3,"names":["css_what_1","require","boolbase_1","__importDefault","sort_js_1","__importStar","general_js_1","subselects_js_1","compile","selector","options","context","next","compileUnsafe","ensureIsTag","adapter","exports","token","parse","compileToken","includesScopePseudo","t","type","SelectorType","Pseudo","name","Array","isArray","data","some","DESCENDANT_TOKEN","Descendant","FLEXIBLE_DESCENDANT_TOKEN","SCOPE_TOKEN","absolutize","_a","hasContext","every","e","parent","isTag","getParent","PLACEHOLDER_ELEMENT","_i","token_1","length","isTraversal","unshift","forEach","default","isArrayContext","finalContext","relativeSelector","Error","shouldTestNextSiblings","query","map","rules","first","second","Adjacent","Sibling","compileRules","reduce","reduceRules","falseFunc","previous","rule","compileGeneralSelector","rootFunc","trueFunc","a","b","combine","elem"],"sources":["https://raw.githubusercontent.com/fb55/css-select/0f0725a9dfeddd2fdb54eda9656cdbab5bbf6be6/src/compile.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}